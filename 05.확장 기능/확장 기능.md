# í™•ì¥ ê¸°ëŠ¥

## ì‚¬ìš©ì ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„

- ìŠ¤í”„ë§ ë°ì´í„° JPA ë ˆíŒŒì§€í† ë¦¬ëŠ” ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜í•˜ê³  êµ¬í˜„ì²´ëŠ” ìŠ¤í”„ë§ì´ ìë™ ìƒì„±
- ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì œê³µí•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì§ì ‘ êµ¬í˜„í•˜ë©´ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ê¸°ëŠ¥ì´ ë„ˆë¬´ ë§ìŒ
- ë‹¤ì–‘í•œ ì´ìœ ë¡œ ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì„œë“œë¥¼ ì§ì ‘ êµ¬í˜„í•˜ê³  ì‹¶ë‹¤ë©´?
    - JPA ì§ì ‘ ì‚¬ìš©(EntityManager)
    - ìŠ¤í”„ë§ JDBC Template ì‚¬ìš©
    - MyBatis ì‚¬ìš©
    - ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ ì§ì ‘ ì‚¬ìš© ë“±ë“±â€¦
    - Querydsl ì‚¬ìš©

**ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤**

```java
package study.datajpa.repository;

import study.datajpa.entity.Member;

import java.util.List;

public interface MemberRepositoryCustom {
    List<Member> findMemberCustom();
}
```

**ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ í´ë˜ìŠ¤**

```java
package study.datajpa.repository;

import jakarta.persistence.EntityManager;
import lombok.RequiredArgsConstructor;
import study.datajpa.entity.Member;

import java.util.List;

@RequiredArgsConstructor
public class MemberRepositoryImpl implements MemberRepositoryCustom{

    private final EntityManager em;

    @Override
    public List<Member> findMemberCustom() {
        return em.createQuery("select m from Member m")
                .getResultList();
    }
}
```

**ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ ìƒì†**

```java
public interface MemberRepository 
					extends JpaRepository<Member, Long> , MemberRepositoryCustom{

}
```

**ì‚¬ìš©ì ì •ì˜ ë©”ì„œë“œ í˜¸ì¶œ ì½”ë“œ**

```java
List<Member> result = memberRepository.findMemberCustom();
```

ì‚¬ìš©ì ì •ì˜ êµ¬í˜„ í´ë˜ìŠ¤

- ê·œì¹™ : ë¦¬í¬ë¹„í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ ì´ë¦„ + `Impl`
- ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì¸ì‹í•´ì„œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡

**Impl ëŒ€ì‹  ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ë³€ê²½í•˜ê³  ì‹¶ìœ¼ë©´?**

**XML ì„¤ì •**

```xml
<repositories base-package="study.datajpa.repository"
                repository-impl-postfix="Impl" />
```

**JavaConfig ì„¤ì •**

```java
@EnableJpaRepositories(basePackages = "study.datajpa.repository",
                           repositoryImplementationPostfix = "Impl")
```

ğŸ’¡Â ì°¸ê³  : ì‹¤ë¬´ì—ì„œëŠ” ì£¼ë¡œ QueryDSLì´ë‚˜ SpringJdbcTemplateì„ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ ì‚¬ìš©ì ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ ê¸°ëŠ¥ ìì£¼ ì‚¬ìš©

ğŸ’¡Â ì°¸ê³  : í•­ìƒ ì‚¬ìš©ì ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ê°€ í•„ìš”í•œ ê²ƒì€ ì•„ë‹ˆë‹¤. ê·¸ëƒ¥ ì„ì˜ì˜ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ë§Œë“¤ì–´ë„ ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´ MemberQueryRepositoryë¥¼ ì¸í„°í˜ì´ìŠ¤ê°€ ì•„ë‹Œ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ê³  ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì„œ ê·¸ëƒ¥ ì§ì ‘ ì‚¬ìš©í•´ë„ ëœë‹¤. ë¬¼ë¡  ì´ ê²½ìš° ìŠ¤í”„ë§ ë°ì´í„° JPAì™€ëŠ” ì•„ë¬´ëŸ° ê´€ê³„ ì—†ì´ ë³„ë„ë¡œ ë™ì‘í•œë‹¤.

### ì‚¬ìš©ì ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ ìµœì‹  ë°©ì‹

ìŠ¤í”„ë§ ë°ì´í„° 2.x ë¶€í„°ëŠ” ì‚¬ìš©ì ì •ì˜ êµ¬í˜„ í´ë˜ìŠ¤ì— ë ˆí¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ ì´ë¦„ + Implì„ ì ìš©í•˜ëŠ” ëŒ€ì‹ ì— ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ ëª… + Impl ë°©ì‹ë„ ì§€ì›í•œë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ì„œ ìœ„ ì˜ˆì œì˜ MemberRepositoryImpl ëŒ€ì‹ ì— MemberRepositoryCustomImpl ê°™ì´ êµ¬í˜„í•´ë„ ëœë‹¤.

**ìµœì‹  ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ í´ë˜ìŠ¤ ì˜ˆì œ**

```java
@RequiredArgsConstructor
public class MemberRepositoryCustomImpl implements MemberRepositoryCustom {

    private final EntityManager em;

    @Override
    public List<Member> findMemberCustom() {
        return em.createQuery("select m from Member m")
                .getResultList();
		}
}
```

ê¸°ì¡´ ë°©ì‹ë³´ë‹¤ ì´ ë°©ì‹ì´ ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ ì´ë¦„ê³¼ êµ¬í˜„ í´ë˜ìŠ¤ ì´ë¦„ì´ ë¹„ìŠ·í•˜ë¯€ë¡œ ë” ì§ê´€ì ì´ë‹¤. ì¶”ê°€ë¡œ ì—¬ëŸ¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë¶„ë¦¬í•´ì„œ êµ¬í˜„í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ìƒˆë¡­ê²Œ ë³€ê²½ëœ ì´ ë°©ì‹ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë” ê¶Œì¥í•œë‹¤.

## Auditing

- ì—”í‹°í‹°ë¥¼ ìƒì„±, ë³€ê²½í•  ë•Œ ë³€ê²½í•œ ì‚¬ëŒê³¼ ì‹œê°„ì„ ì¶”ì í•˜ê³  ì‹¶ìœ¼ë©´?
    - ë“±ë¡ì¼
    - ìˆ˜ì •ì¼
    - ë“±ë¡ì
    - ìˆ˜ì •ì

### ìˆœìˆ˜ JPA ì‚¬ìš©

ë“±ë¡ì¼, ìˆ˜ì •ì¼ ì ìš©

```java
package study.datajpa.entity;

import jakarta.persistence.Column;
import jakarta.persistence.MappedSuperclass;
import jakarta.persistence.PrePersist;
import jakarta.persistence.PreUpdate;
import lombok.Getter;

import java.time.LocalDateTime;

@MappedSuperclass
@Getter
public class JpaBaseEntity {

    @Column(updatable = false)
    private LocalDateTime createdDate;
    private LocalDateTime updatedDate;

    @PrePersist
    public void prePersist() {
        LocalDateTime now = LocalDateTime.now();
        createdDate = now;
        updatedDate = now;
    }

    @PreUpdate
    public void preUpdate() {
        updatedDate = LocalDateTime.now();
    }

}
```

```java
public class Member extends JpaBaseEntity {}
```

**í™•ì¸ ì½”ë“œ**

```java
@Test
public void jpaEventBaseEntity() throws Exception {
    //given
    Member member = new Member("member1");
    memberRepository.save(member);  //@PrePersist

    Thread.sleep(100);
    member.setUsername("member2");

    em.flush();  //@PreUpdate
    em.clear();

    //when
    Member findMember = memberRepository.findById(member.getId()).get();

    //then
    System.out.println("findMember.createdDate = " + findMember.getCreatedDate());
    System.out.println("findMember.updatedDate = " + findMember.getUpdatedDate());
}
```

**JPA ì£¼ìš” ì´ë²¤íŠ¸ ì–´ë…¸í…Œì´ì…˜**

- @RePersist, @PostPersist
- @PreUpdate, @PostUpdate

### ìŠ¤í”„ë§ ë°ì´í„° JPA ì‚¬ìš©

**ì„¤ì •**

`@EnableJpaAuditing` â†’ ìŠ¤í”„ë§ ë¶€íŠ¸ ì„¤ì • í´ë˜ìŠ¤ì— ì ìš©í•´ì•¼í•¨

`@EntityListeners(AuditingEntityListner.class)` â†’ ì—”í‹°í‹°ì— ì ìš©

**ì‚¬ìš© ì–´ë…¸í…Œì´ì…˜**

- `@CreatedDate`
- `@LastModifiedDate`
- `@CreatedBy`
- `@LastModifiedBy`

**ìŠ¤í”„ë§ ë°ì´í„° Auditing ì ìš© - ë“±ë¡ì¼, ìˆ˜ì •ì¼**

```java
package study.datajpa.entity;

import jakarta.persistence.Column;
import jakarta.persistence.EntityListeners;
import jakarta.persistence.MappedSuperclass;
import lombok.Getter;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import java.time.LocalDateTime;

@EntityListeners(AuditingEntityListener.class)
@MappedSuperclass
@Getter
public class BaseEntity {

    @CreatedDate
    @Column(updatable = false)
    private LocalDateTime createdDate;

    @LastModifiedDate
    private LocalDateTime lastModifiedDate;
}
```

**ìŠ¤í”„ë§ ë°ì´í„° Auditing ì ìš© - ë“±ë¡ì, ìˆ˜ì •ì**

```java
package study.datajpa.entity;

import jakarta.persistence.Column;
import jakarta.persistence.EntityListeners;
import jakarta.persistence.MappedSuperclass;
import lombok.Getter;
import org.springframework.data.annotation.CreatedBy;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedBy;
import org.springframework.data.annotation.LastModifiedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import java.time.LocalDateTime;

@EntityListeners(AuditingEntityListener.class)
@MappedSuperclass
@Getter
public class BaseEntity {

    @CreatedDate
    @Column(updatable = false)
    private LocalDateTime createdDate;

    @LastModifiedDate
    private LocalDateTime lastModifiedDate;

    @CreatedBy
    @Column(updatable = false)
    private String createdBy;

    @LastModifiedBy
    private String lastModifiedBy;
}
```

**ë“±ë¡ì, ìˆ˜ì •ìë¥¼ ì²˜ë¦¬í•´ì£¼ëŠ” AuditorAware ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡**

```java
package study.datajpa;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.data.domain.AuditorAware;
import org.springframework.data.jpa.repository.config.EnableJpaAuditing;

import java.util.Optional;
import java.util.UUID;

@EnableJpaAuditing
@SpringBootApplication
public class DataJpaApplication {

	public static void main(String[] args) {
		SpringApplication.run(DataJpaApplication.class, args);
	}
	
	@Bean
	public AuditorAware<String> auditorProvider() {
		return () -> Optional.of(UUID.randomUUID().toString());
	}

}
```

âš ï¸Â ì£¼ì˜ : DataJpaApplicationì— @EnableJpaAuditingë„ í•¨ê»˜ ë“±ë¡í•´ì•¼ í•œë‹¤.

ì‹¤ë¬´ì—ì„œëŠ” ì„¸ì…˜ ì •ë³´ë‚˜, ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ë¡œê·¸ì¸ ì •ë³´ì—ì„œ IDë¥¼ ë°›ìŒ

> ì°¸ê³  : ì‹¤ë¬´ì—ì„œ ëŒ€ë¶€ë¶„ì˜ ì—”í‹°í‹°ëŠ” ë“±ë¡ì‹œê°„, ìˆ˜ì •ì‹œê°„ì´ í•„ìš”í•˜ì§€ë§Œ, ë“±ë¡ì, ìˆ˜ì •ìëŠ” ì—†ì„ ìˆ˜ë„ ìˆë‹¤. ê·¸ë˜ì„œ ë‹¤ìŒê³¼ ê°™ì´ Base íƒ€ì…ì„ ë¶„ë¦¬í•˜ê³ , ì›í•˜ëŠ” íƒ€ì´ì„ ì„ íƒí•´ì„œ ìƒì†í•œë‹¤.
> 

```java
package study.datajpa.entity;

import jakarta.persistence.Column;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedDate;

import java.time.LocalDateTime;

public class BaseTimeEntity {

    @CreatedDate
    @Column(updatable = false)
    private LocalDateTime createdDate;

    @LastModifiedDate
    private LocalDateTime lastModifiedDate;
    
}
```

```java
package study.datajpa.entity;

import jakarta.persistence.Column;
import jakarta.persistence.EntityListeners;
import jakarta.persistence.MappedSuperclass;
import lombok.Getter;
import org.springframework.data.annotation.CreatedBy;
import org.springframework.data.annotation.LastModifiedBy;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

@EntityListeners(AuditingEntityListener.class)
@MappedSuperclass
@Getter
public class BaseEntity extends BaseTimeEntity{

    @CreatedBy
    @Column(updatable = false)
    private String createdBy;

    @LastModifiedBy
    private String lastModifiedBy;
}
```

> ğŸ’¡ì°¸ê³  : ì €ì¥ì‹œì ì— ë“±ë¡ì¼, ë“±ë¡ìëŠ” ë¬¼ë¡ ì´ê³ , ìˆ˜ì •ì¼, ìˆ˜ì •ìë„ ê°™ì€ ë°ì´í„°ê°€ ì €ì¥ëœë‹¤. ë°ì´í„°ê°€ ì¤‘ë³µ ì €ì¥ë˜ëŠ” ê²ƒ ê°™ì§€ë§Œ, ì´ë ‡ê²Œ í•´ë‘ë©´ ë³€ê²½ ì»¬ëŸ¼ë§Œ í™•ì¸í•´ë„ ë§ˆì§€ë§‰ì— ì—…ë°ì´íŠ¸í•œ ìœ ì €ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìœ ì§€ë³´ìˆ˜ ê´€ì ì—ì„œ í¸ë¦¬í•˜ë‹¤. ì´ë ‡ê²Œ í•˜ì§€ ì•Šìœ¼ë©´ ë³€ê²½ ì»¬ëŸ¼ì´ nullì¼ ë•Œ ë“±ë¡ ì»¬ëŸ¼ì„ ë˜ ì°¾ì•„ì•¼ í•œë‹¤.
ì°¸ê³ ë¡œ ì €ì¥ì‹œì ì— ì €ì¥ë°ì´í„°ë§Œ ì…ë ¥í•˜ê³  ì‹¶ìœ¼ë©´ `@EnableJpaAudigin(modifyOnCreate = false)` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
> 

### ì „ì²´ ì ìš©

`@EntityListeners(AuditingEntityListener.class)`ë¥¼ ìƒëµí•˜ê³  ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì œê³µí•˜ëŠ” ì´ë²¤íŠ¸ë¥¼ ì—”í‹°í‹° ì „ì²´ì— ì ìš©í•˜ë ¤ë©´ orm.xmlì— ë‹¹ë¯€ê³¼ ê°™ì´ ë“±ë¡í•˜ë©´ ëœë‹¤.

`META-INF/orm.xml`

```xml
<?xml version=â€œ1.0â€ encoding="UTF-8â€?>
    <entity-mappings xmlns=â€œhttp://xmlns.jcp.org/xml/ns/persistence/ormâ€
                     xmlns:xsi=â€œhttp://www.w3.org/2001/XMLSchema-instanceâ€
                     xsi:schemaLocation=â€œhttp://xmlns.jcp.org/xml/ns/persistence/
    orm http://xmlns.jcp.org/xml/ns/persistence/orm_2_2.xsdâ€
                     version=â€œ2.2">
        <persistence-unit-metadata>
            <persistence-unit-defaults>
                <entity-listeners>
                    <entity-listener class="org.springframework.data.jpa.domain.support.AuditingEntityListenerâ€/>
            </entity-listeners>
        </persistence-unit-defaults>
    </persistence-unit-metadata>
</entity-mappings>
```

## Web í™•ì¥ - ë„ë©”ì¸ í´ë˜ìŠ¤ ì»¨ë²„í„°

HTTP íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ ì—”í‹°í‹°ì˜ ì•„ì´ë””ë¡œ ì—”í‹°í‹° ê°ì²´ë¥¼ ì°¾ì•„ì„œ ë°”ì¸ë”©

**ë„ë©”ì¸ í´ë˜ìŠ¤ ì»¨ë²„í„° ì‚¬ìš© ì „**

```java
package study.datajpa.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;
import study.datajpa.entity.Member;
import study.datajpa.repository.MemberRepository;

@RestController
@RequiredArgsConstructor
public class MemberController {

    private final MemberRepository memberRepository;

    @GetMapping("/members/{id}")
    public String findMember(@PathVariable("id") Long id) {
        Member member = memberRepository.findById(id).get();
        return member.getUsername();
    }
}
```

**ë„ë©”ì¸ í´ë˜ìŠ¤ ì»¨ë²„í„° ì‚¬ìš© í›„**

```java
package study.datajpa.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;
import study.datajpa.entity.Member;
import study.datajpa.repository.MemberRepository;

@RestController
@RequiredArgsConstructor
public class MemberController {

    private final MemberRepository memberRepository;

    @GetMapping("/members/{id}")
    public String findMember(@PathVariable("id") Member member) {
        return member.getUsername();
    }
}
```

- HTTP ìš”ì²­ì€ íšŒì› idë¥¼ ë°›ì§€ë§Œ ë„ë©”ì¸ í´ë˜ìŠ¤ ì»¨ë²„í„°ê°€ ì¤‘ê°„ì— ë™ì‘í•´ì„œ íšŒì› ì—”í‹°í‹° ê°ì²´ë¥¼ ë°˜í™˜
- ë„ë©”ì¸ í´ë˜ìŠ¤ ì»¨ë²„í„°ë„ ë ˆíŒŒì§€í† ë¦¬ë¥¼ ì‚¬ìš©í•´ì„œ ì—”í‹°í‹°ë¥¼ ì°¾ìŒ

> âš ï¸Â ì£¼ì˜ : ë„ë©”ì¸ í´ë˜ìŠ¤ ì»¨ë²„í„°ë¡œ ì—”í‹°í‹°ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìœ¼ë©´, ì´ ì—”í‹°í‹°ëŠ” ë‹¨ìˆœ ì¡°íšŒìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
(íŠ¸ëœì­ì…˜ì´ ì—†ëŠ” ë²”ìœ„ì—ì„œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí–ˆìœ¼ë¯€ë¡œ, ì—”í‹°í‹°ë¥¼ ë³€ê²½í•´ë„ DBì— ë°˜ì˜ë˜ì§€ ì•ŠëŠ”ë‹¤.)
> 

## Web í™•ì¥ - í˜ì´ì§•ê³¼ ì •ë ¬

ìŠ¤í”„ë§ ë°ì´í„°ê°€ ì œê³µí•˜ëŠ” í˜ì´ì§•ê³¼ ì •ë ¬ ê¸°ëŠ¥ì„ ìŠ¤í”„ë§ MVCì—ì„œ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

**í˜ì´ì§•ê³¼ ì •ë ¬ ì˜ˆì œ - `MemberController`**

```java
@GetMapping("/members")
public Page<Member> list(Pageable pageable) {
    Page<Member> page = memberRepository.findAll(pageable);
    return page;
}
```

- íŒŒë¼ë¯¸í„°ë¡œ `Pageable`ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.
- `Pageable`ì€ ì¸í„°í˜ì´ìŠ¤, ì‹¤ì œëŠ” `org.springframework.data.domain.RageRequest` ê°ì²´ ìƒì„±

**ìš”ì²­ íŒŒë¼ë¯¸í„°**

- ì˜ˆ) `/members?page=0&size=3&sort=id,desc&sort=username,desc`
- page: í˜„ì¬ í˜ì´ì§€, **0ë¶€í„° ì‹œì‘í•œë‹¤.**
- size: í•œ í˜ì´ì§€ì— ë…¸ì¶œí•  ë°ì´í„° ê±´ìˆ˜
- sort: ì •ë ¬ ì¡°ê±´ì„ ì •ì˜í•œë‹¤. ì˜ˆ) ì •ë ¬ ì†ì„±, ì •ë ¬ ì†ì„±â€¦(ASC|DESC), ì •ë ¬ ë°©í–¥ì„ ë³€ê²½í•˜ê³  ì‹¶ìœ¼ë©´ sort íŒŒë¼ë¯¸í„° ì¶”ê°€(`asc` ìƒëµ ê°€ëŠ¥)

**ê¸°ë³¸ê°’**

- ê¸€ë¡œë²Œ ì„¤ì • : ìŠ¤í”„ë§ ë¶€íŠ¸
    
    ```java
    spring.data.web.pageable.default-page-size=20 /# ê¸°ë³¸ í˜ì´ì§€ ì‚¬ì´ì¦ˆ/
    spring.data.web.pageable.max-page-size=2000 /# ìµœëŒ€ í˜ì´ì§€ ì‚¬ì´ì¦ˆ/
    ```
    

- ê°œë³„ ì„¤ì •
    
    `@PageableDefault` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©
    
    ```java
    @RequestMapping(value = "/members_page", method = RequestMethod.GET)
    public String list(@PageableDefault(size = 12, sort = â€œusernameâ€,
    		direction = Sort.Direction.DESC) Pageable pageable) {
    
    		...
    }
    
    ```
    

**ì ‘ë‘ì‚¬**

- í˜ì´ì§• ì •ë³´ê°€ ë‘˜ ì´ìƒì´ë©´ ì ‘ë‘ì‚¬ë¡œ êµ¬ë¶„
- `@Qualifier`ì— ì ‘ë‘ì‚¬ëª… ì¶”ê°€ â€œ{ì ‘ë‘ì‚¬ëª…}_xxxâ€
- ì˜ˆì œ: `/members?member_page=0&order_page=1`

```java
public String list(
    @Qualifier("member") Pageable memberPageable,
    @Qualifier("order") Pageable orderPageable, ...
```

### Page ë‚´ìš©ì„ DTOë¡œ ë³€í™˜í•˜ê¸°

- ì—”í‹°í‹°ë¥¼ APIë¡œ ë…¸ì¶œí•˜ë©´ ë‹¤ì–‘í•œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤. ê·¸ë˜ì„œ ì—”í‹°í‹°ë¥¼ ê¼­ DTOë¡œ ë³€í™˜í•´ì„œ ë°˜í™˜í•´ì•¼ í•œë‹¤.
- PageëŠ” map()ì„ ì§€ì›í•´ì„œ ë‚´ë¶€ ë°ì´í„°ë¥¼ ë‹¤ë¥¸ ê²ƒìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

**Member DTO**

```java
package study.datajpa.repository;

import lombok.Data;
import study.datajpa.entity.Member;

@Data
public class MemberDto {
    private Long id;
    private String username;
    private String teamName;

    public MemberDto(Long id, String username, String teamName) {
        this.id = id;
        this.username = username;
        this.teamName = teamName;
    }

    public MemberDto() {

    }

    public MemberDto(Member m) {
        this.id = m.getId();
        this.username = m.getUsername();
    }
}
```

`Page.map()` ì‚¬ìš©

```java
@GetMapping("/members")
public Page<MemberDto> list(Pageable pageable) {
    Page<Member> page = memberRepository.findAll(pageable);
    Page<MemberDto> pageDto = page.map(MemberDto::new);
    return pageDto;
}
```

`Page.map()` ì½”ë“œ ìµœì í™”

```java
@GetMapping("/members")
public Page<MemberDto> list(Pageable pageable) {
    return memberRepository.findAll(pageable).map(MemberDto::new);
}
```

### Pageë¥¼ 1ë¶€í„° ì‹œì‘í•˜ê¸°

- ìŠ¤í”„ë§ ë°ì´í„°ëŠ” Pageë¥¼ 0ë¶€í„° ì‹œì‘í•œë‹¤.
- ë§Œì•½ 1ë¶€í„° ì‹œì‘í•˜ë ¤ë©´?
    1. Pageable, Pageë¥¼ íŒŒë¼ë¯¸í„°ì™€ ì‘ë‹µ ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ì§ì ‘ í¬ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ì²˜ë¦¬í•œë‹¤. ê·¸ë¦¬ê³  ì§ì ‘ PageRequest(Pageable êµ¬í˜„ì²´)ë¥¼ ìƒì„±í•´ì„œ ë¦¬í¬ì§€í† ë¦¬ì— ë„˜ê¸´ë‹¤. ë¬¼ë¡  ì‘ë‹µê°’ë„ Page ëŒ€ì‹ ì— ì§ì ‘ ë§Œë“¤ì–´ì„œ ì œê³µí•´ì•¼ í•œë‹¤.
    2. `spring.data.web.pageable.one-indexed-parameters`ë¥¼ `true`ë¡œ ì„¤ì •í•œë‹¤. ê·¸ëŸ°ë° ì´ ë°©ë²•ì€ webì—ì„œ page íŒŒë¼ë¯¸í„°ë¥¼ `-1` ì²˜ë¦¬ í•  ë¿ì´ë‹¤. ë”°ë¼ì„œ ì‘ë‹µê°’ì¸ `page`ì— ëª¨ë‘ 0 í˜ì´ì§€ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” í•œê³„ê°€ ìˆë‹¤.
    

`one-indexed-parameters` Page 1ìš”ì²­( [`http://localhost:8080/members?page=1](http://localhost:8080/members?page=1)` )